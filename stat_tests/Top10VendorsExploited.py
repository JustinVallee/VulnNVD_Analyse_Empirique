import ast
from collections import Counter

import pandas as pd
import matplotlib.pyplot as plt

# Read the CSV file into a DataFrame
year = 2019
df = pd.read_csv(f'cves_{year}_BoolExploited_with_vendors_products.csv')

#all_unique_exploited_vendors = set() # un set pour garder seulement les uniques pour savoir qui compter
all_exploited_vendors = []

# Iterate over each row in the DataFrame
for index, row in df.iterrows():
    if row['exploited'] == 1:
        if row['Unique Vendors'] != '[]':
            list_cell = ast.literal_eval(row['Unique Vendors'])
            for vendor in list_cell:
                #all_unique_exploited_vendors.add(vendor)
                all_exploited_vendors.append(vendor)

print(all_exploited_vendors)

# Count occurrences of each vendor
vendor_counts = Counter(all_exploited_vendors) # Counts as a Counter obj, same format as a dict but its an obj

# Convert Counter object to dictionary
count_all_vendors = dict(vendor_counts)

# Sort vendors by count in descending order
sorted_vendors = sorted(count_all_vendors.items(), key=lambda item: item[1], reverse=True) # reverse ou d√©croissant

# Get the top 10 vendors
top_10_vendors = sorted_vendors[:10]
print(top_10_vendors)
total_count = len(all_exploited_vendors)
print(total_count)

# Print or use the top 10 vendors
for vendor, count in top_10_vendors:
    percent = count/total_count*100
    print(f"{vendor}: {count} - ({percent:.2f}%)")

print(count_all_vendors)
#print(all_unique_exploited_vendors)
#print(all_exploited_vendors)